<?xml version="1.0" encoding="iso-8859-1" ?>
<aiscript name="mule.lib.debug.dump_priority" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="p:\X4\Database\libraries\aiscripts.xsd" version="8">
	<params>
		<!-- priority to dump -->
		<param name="priority"/>
		<!-- enable/disable debug messages -->
		<param name="debugchance"/>
		<param name="debugFileName"/>
		<param name="debugDirName"/>
  </params>
  <attention min="unknown">
    <actions>
			<do_if value="$debugchance">
				<!-- populate variables -->
				<get_factions_by_relation relation="dock" result="$allDockableFactions" object="this.ship"/>
				<!-- format: buy from faction -->
				<do_if value="$priority.$buyFromFaction == faction.player">
					<set_value name="$buyFromFactionString" exact="'player'"/>
				</do_if>
				<do_elseif value="$priority.$buyFromFaction == $allDockableFactions">
					<set_value name="$buyFromFactionString" exact="'all dockable factions'"/>
				</do_elseif>
				<do_else>
					<set_value name="$buyFromFactionString" exact="$priority.$buyFromFaction"/>
				</do_else>
				<!-- format: supply -->
				<do_if value="(typeof $priority.$serve == datatype.faction) and ($priority.$serve == faction.player)">
					<set_value name="$serveString" exact="'player'"/>
				</do_if>
				<do_elseif value="(typeof $priority.$serve == datatype.component) and $priority.$serve.isclass.station">
					<set_value name="$serveString" exact="'%s (%s)'.[$priority.$serve.knownname, $priority.$serve.idcode]"/>
				</do_elseif>
				<do_elseif value="(typeof $priority.$serve == datatype.component) and $priority.$serve.isclass.sector">
					<set_value name="$serveString" exact="'%s (sector)'.[$priority.$serve.knownname]"/>
				</do_elseif>
				<do_else>
					<set_value name="$serveString" exact="$priority.$serve"/>
				</do_else>
				
				<!-- write debug message -->
				<debug_to_file chance="$debugchance" name="$debugFileName" directory="$debugDirName" text="'Current priority is to supply &quot;%s&quot; by buying &quot;%s&quot; from &quot;%s&quot;'.[$serveString, $priority.$type, $buyFromFactionString]" />
				<debug_to_file chance="$debugchance" name="$debugFileName" directory="$debugDirName" text="'------------------------------------------------------------------------------------------------------------------------------------'" />
			</do_if>
    </actions>
  </attention>
</aiscript>
