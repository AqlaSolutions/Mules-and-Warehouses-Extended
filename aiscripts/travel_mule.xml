<?xml version="1.0" encoding="utf-8" ?>
<aiscript name="travelmule" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://x4libonline.ddns.net\libraries\aiscripts.xsd" version="1">
	<!-- Setup context menu order -->
	<order id="TravelMule" name="M1- Travel Mule" description="Ferries supplies between stations" category="trade" infinite="true">
		<params>
			<!-- menu option: Source Station (Define Source Station) -->
			<param name="sourceStation" required="false" default="null" type="object" text="Source Station" comment="The source station">
				<input_param name="class" value="[class.station]" />
			</param>
			<!-- menu option: Max Gate Distance -->
			<param name="maxDist" required="false" default="8" type="number" text="Max Jumps" comment="Max Gate Distance to sell.">
				<input_param name="startvalue" value="15" />
				<input_param name="min" value="0" />
				<input_param name="max" value="15" />
				<input_param name="step" value="1" />
			</param>
			<!-- menu option: Profit Override Percentage (Used when buying/selling at own warehouses mostly) -->
			<param name="profitMargin" default="90" type="number" text="Profit Override" comment="Owned Station Buy price adjustment, 0=Sell all wares regardless of trade offer price. 100= Obey Station Manager's buy offer.">
				<input_param name="startvalue" value="90" />
				<input_param name="min" value="0" />
				<input_param name="max" value="100" />
				<input_param name="step" value="5" />
			</param>

			<!-- menu option: WareBasket List -->
			<param name="specialWareBasket" required="false" default="[]" type="list" text="Wares (all by default)" comment="Which Wares to consider in the trade.">
				<input_param name="type" value="'ware'" />
				<input_param name="cancarry" value="this.ship" />
			</param>
			<!-- menu option: Cargo Percentage Used for Trade -->
			<param name="minCargoUsed" default="80" type="number" text="Fill Cargo Hold %" comment="The percentage of the ship's cargo hold that the trade will take up.">
				<input_param name="startvalue" value="80" />
				<input_param name="min" value="25" />
				<input_param name="max" value="95" />
				<input_param name="step" value="5" />
			</param>

			<!-- menu option: Target NPC Shipyards, Whalfs, Equipment Docks -->
			<param name="tradeWithBig" required="false" type="bool" default="false" text="Target NPC Shipyards" comment="Assign to trade with all NPC shipyards, wharfs, and equip docks." />
			<!-- menu option: Target All NPC Stations (trade with any station toggle) -->
			<param name="tradeWithAll" required="false" type="bool" default="true" text="Target All NPC Stations" comment="Assign to trade with all NPC stations." />

			<!-- menu option: Destination Override (select stations manually to visit) -->
			<param name="destList" required="false" default="[]" type="list" text="Custom Stop List (Replaces 'Target' Options)" comment="Manually choose Points to visit.">
				<input_param name="type" value="'object'" />
			</param>
		</params>
		<requires>
			<!-- The requirements of ships in order to be eligible get this order (requirements can be skill-level requirements or ship-type requirements) -->
			<!-- This denies laser towers from being able to get this order (more precisely in our case, this default behaviour) -->
			<match shiptype="shiptype.lasertower" negate="true" />
		</requires>
	</order>

	<interrupts>
		<handler ref="AttackHandler" />
		<handler ref="MissileLockHandler" />
		<handler ref="ScannedHandler" />
		<handler ref="InspectedHandler" />
		<handler ref="FoundAbandonedHandler" />
		<handler ref="ResupplyHandler" />
		<handler ref="JobRemoveRequestHandler" />
		<handler ref="TargetInvalidHandler" />
	</interrupts>

	<init>
		<set_value name="$debugchance" exact="100" />
		<set_value name="$object" exact="this.assignedcontrolled" />
		<set_order_syncpoint_reached order="this.ship.order" />
		<set_command_action commandaction="commandaction.searchingtrades" />
		<do_if value="($sourceStation.owner == this.ship.owner)">
			<set_object_commander object="this.ship" commander="$sourceStation"  assignment="assignment.trade" />
		</do_if>
	</init>

	<attention min="unknown">
		<actions>
			<label name="start" />
			<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'Starting Log File'" output="false" append="false" />

			<set_value name="$needFound" exact="false" />
			<set_value name="$supplyTarget" exact="0" />
			<set_value name="$supplySource" exact="0" />
			<set_value name="$bestProfit" exact="0" />
			<set_value name="$bestCargo" exact="0" />
			<set_value name="$currentProfit" exact="0" />
			<create_list name="$supplies" />
			<create_list name="$needs" />
			<create_list name="$innerList" />
			<create_list name="$outerList" />
			<create_list name="$tempList" />

			<!-- Sell leftover cargo before resuming regular Mule routine -->
			<set_value name="$profitScale" exact="50" />
			<set_value name="$pilotSkill" exact="this.ship.pilot.skill.piloting" />
			<set_value name="$maxBuyRelPrice" exact="((-0.325-0.025*($pilotSkill)f)/90.0-0.01)*($profitScale)f+1-(-0.325-0.025*($pilotSkill)f)/9.0" />
			<set_value name="$searchStep" exact="(1.0-$maxBuyRelPrice)/4.0" />

			<set_value name="$cargo" exact="this.ship.cargo.list" />

			<do_all exact="$cargo.count" counter="$wareInCargo">
				<wait min="50ms" max="150ms" />

				<set_value name="$currentWare" exact="$cargo.{$wareInCargo}" />
				<set_value name="$amount" exact="this.ship.cargo.{$currentWare}.count" />
				<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'trying to sell '+$amount+' '+$currentWare+' from cargo'" />

				<do_all exact="5" counter="$reduction">
					<!-- searching suiting buy offer, will search 5 times reducing requirements each time by 20% (just want to get rid of that stuff at some point) -->
					<find_buy_offer tradepartner="this.ship" space="player.galaxy" result="$buyOffer" wares="$currentWare">
						<match_buyer tradesknownto="this.owner">
							<match_gate_distance object="this.ship" min="0" max="$maxDist">
								<blacklist group="blacklistgroup.civilian" object="this.ship" />
							</match_gate_distance>
							<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.objectactivity" object="this.ship" />
							<match_parent>
								<match_parent>
									<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectortravel" object="this.ship" />
									<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectoractivity" object="this.ship" />
								</match_parent>
							</match_parent>
						</match_buyer>
						<relativeprice min="-$maxBuyRelPrice-(($reduction)f-1.0)*$searchStep-0.001" />
						<amount min="$amount*(0.8^($reduction-1))" />
					</find_buy_offer>
					<wait min="50ms" max="150ms" />

					<do_if value="$buyOffer == null">
						<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'  could not find buyer for min amount: '+$amount*(0.8^($reduction-1))+ ' min relative price: '+(-$maxBuyRelPrice-(($reduction)f-1.0)*$searchStep-0.001)+', max gates :'+($maxSell+$reduction-1)" />
						<continue />
					</do_if>

					<set_value name="$amount" exact="[$amount,$buyOffer.amount].min" />

					<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'  found buyer: ownername: '+$buyOffer.owner.knownname+'('+$buyOffer.owner.owner.knownname+'), unitprice: '+$buyOffer.unitprice+', amount: '+$buyOffer.amount+', relative price: '+$buyOffer.relativeprice+', totalprice: '+$buyOffer.price+', sector: '+$buyOffer.owner.sector.knownname+', gates from this ship: '+$buyOffer.owner.gatedistance.{this.ship}+', gates from home (from ship if not homebound): '+$buyOffer.owner.gatedistance.{this.ship}+'. selling amount: '+$amount" />

					<do_if value="$buyOffer.available">
						<write_to_logbook category="general" title="'TravelMule: '+this.ship.knownname+' ( '+this.ship.idcode+' )'" interaction="showonmap" object="this.ship" money="$buyOffer.unitprice*$amount" text="'Selling '+$amount+' '+$currentWare+', unitprice: '+$buyOffer.unitprice/100" />
						<create_trade_order object="this.ship" amount="$amount" tradeoffer="$buyOffer" />
						<debug_to_file name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'  trade created'" />
						<resume label="end" />
					</do_if>
					<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'  offer not available anymore'" />
				</do_all>
				<show_notification text="['TravelMule: '+this.ship.knownname+' ('+this.ship.idcode+')', '', 'can\'t empty cargo', [$amount+' '+$currentWare, 255, 192, 126]]" sound="notification_warning" />
				<write_to_logbook category="general" title="'TravelMule: '+this.ship.knownname+' ( '+this.ship.idcode+' )'" interaction="showonmap" object="this.ship" text="'can\'t get rid of '+$amount+' '+$currentWare+' from cargo, what should I do?'" />
			</do_all>
			<remove_value name="$searchStep" />
			<remove_value name="$cargo" />
			<remove_value name="$buyOffer" />

			<do_if value="this.ship.cargo.free.container lt (this.ship.cargo.capacity.container/10)">
				<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'TravelMule'" text="'  cargo is full =('" />
				<wait min="50ms" max="150ms" />
				<resume label="start" />
			</do_if>

			<set_value name="$wareBasket" exact="$specialWareBasket" />
			<do_if value="$wareBasket == []">
				<do_if value="$sourceStation.tradewares.count">
					<set_value name="$wareBasket" exact="$sourceStation.tradewares.list" />
				</do_if>
				<do_elseif value="$sourceStation.products.count">
					<set_value name="$wareBasket" exact="$sourceStation.products.list" />
				</do_elseif>
			</do_if>

			<!-- technically sourceStation could be owned by someone on the blacklist, but the player picked this manually -->
			<find_sell_offer tradepartner="this.ship" seller="$sourceStation" result="$supplies" wares="$wareBasket" multiple="true">
				<match_seller>
					<match_gate_distance object="this.ship" min="0">
						<blacklist group="blacklistgroup.civilian" object="this.ship" />
					</match_gate_distance>
					<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.objectactivity" object="this.ship" />
					<match_parent>
						<match_parent>
							<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectortravel" object="this.ship" />
							<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectoractivity" object="this.ship" />
						</match_parent>
					</match_parent>
				</match_seller>
			</find_sell_offer>

			<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'supplies: ' +$supplies" output="false" append="true" />


			<!-- TODO: refactor these blocks -->
			<!-- maxDist of 15 is the equivalent of "no limit" apparently -->
			<!-- Finding Buyers -->
			<do_if value="$destList == []">
				<do_if value="$maxDist == 15">
					<do_if value="$tradeWithAll">
						<find_buy_offer tradepartner="this.ship" space="player.galaxy" result="$needs" wares="$wareBasket" multiple="true">
							<match_buyer>
								<match_gate_distance object="$sourceStation" min="0">
									<blacklist group="blacklistgroup.civilian" object="this.ship" />
								</match_gate_distance>
								<match_relation_to object="this.ship" relation="enemy" comparison="not" />
								<match tradesknownto="this.owner" />
								<match owner="this.ship.owner" negate="true" />
								<match class="class.station" />
								<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.objectactivity" object="this.ship" />
								<match_parent>
									<match_parent>
										<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectortravel" object="this.ship" />
										<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectoractivity" object="this.ship" />
									</match_parent>
								</match_parent>
							</match_buyer>
						</find_buy_offer>
					</do_if>
					<do_elseif value="$tradeWithBig">
						<find_buy_offer tradepartner="this.ship" space="player.galaxy" result="$needs" wares="$wareBasket" multiple="true">
							<match_buyer>
								<match_gate_distance object="$sourceStation" min="0">
									<blacklist group="blacklistgroup.civilian" object="this.ship" />
								</match_gate_distance>
								<match_relation_to object="this.ship" relation="enemy" comparison="not" />
								<match tradesknownto="this.owner" />
								<match owner="this.ship.owner" negate="true" />
								<match class="class.station" />
								<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.objectactivity" object="this.ship" />
								<match_parent>
									<match_parent>
										<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectortravel" object="this.ship" />
										<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectoractivity" object="this.ship" />
									</match_parent>
								</match_parent>
								<match_any>
									<match canbuildships="true" />
									<match canequipships="true" />
								</match_any>
							</match_buyer>
						</find_buy_offer>
					</do_elseif>
				</do_if>
				<do_else>
					<find_cluster_in_range distances="$clusterstable" multiple="true" object="$sourceStation.cluster" mindistance="0" maxdistance="$maxDist" />
					<set_value name="$sellspaces" exact="$clusterstable.keys.sorted" />
					<remove_value name="$clusterstable" />
					<do_all exact="$sellspaces.count" counter="$sector">
						<do_if value="$tradeWithAll">
							<find_buy_offer tradepartner="this.ship" space="$sellspaces.{$sector}" result="$tempList" wares="$wareBasket" multiple="true">
								<match_buyer>
									<match_gate_distance object="$sourceStation" max="$maxDist">
										<blacklist group="blacklistgroup.civilian" object="this.ship" />
									</match_gate_distance>
									<match_relation_to object="this.ship" relation="enemy" comparison="not" />
									<match tradesknownto="this.owner" />
									<match owner="this.ship.owner" negate="true" />
									<match class="class.station" />
									<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.objectactivity" object="this.ship" />
									<match_parent>
										<match_parent>
											<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectortravel" object="this.ship" />
											<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectoractivity" object="this.ship" />
										</match_parent>
									</match_parent>
								</match_buyer>
							</find_buy_offer>
						</do_if>
						<do_elseif value="$tradeWithBig">
							<find_buy_offer tradepartner="this.ship" space="$sellspaces.{$sector}" result="$tempList" wares="$wareBasket" multiple="true">
								<match_buyer>
									<match_gate_distance object="$sourceStation" max="$maxDist">
										<blacklist group="blacklistgroup.civilian" object="this.ship" />
									</match_gate_distance>
									<match_relation_to object="this.ship" relation="enemy" comparison="not" />
									<match tradesknownto="this.owner" />
									<match owner="this.ship.owner" negate="true" />
									<match class="class.station" />
									<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.objectactivity" object="this.ship" />
									<match_parent>
										<match_parent>
											<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectortravel" object="this.ship" />
											<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectoractivity" object="this.ship" />
										</match_parent>
									</match_parent>
									<match_any>
										<match canbuildships="true" />
										<match canequipships="true" />
									</match_any>
								</match_buyer>
							</find_buy_offer>
						</do_elseif>

						<do_all exact="$tempList.count" counter="$tl">
							<append_to_list name="$needs" exact="$tempList.{$tl}" />
						</do_all>
					</do_all>
				</do_else>
				<!-- <debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'needs: ' +$needs" output="false" append="true" /> -->
				<!-- <do_all exact="$needs.count" counter="$i"> <debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="' ' +$needs.{$i}.ware + ' ' +$needs.{$i}.owner.knownname" output="false" append="true" /> </do_all> -->
			</do_if>

			<do_else>
				<do_all exact="$destList.count" counter="$customer">
					<!-- the destList was built by the user manually in the UI so dont filter by blacklist -->
					<find_buy_offer tradepartner="this.ship" buyer="$destList.{$customer}" result="$tempList" wares="$wareBasket" multiple="true">
						<match_buyer>
							<match_gate_distance object="$sourceStation" max="$maxDist">
								<blacklist group="blacklistgroup.civilian" object="this.ship" />
							</match_gate_distance>
							<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.objectactivity" object="this.ship" />
							<match_parent>
								<match_parent>
									<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectortravel" object="this.ship" />
									<match_use_blacklist group="blacklistgroup.civilian" type="blacklisttype.sectoractivity" object="this.ship" />
								</match_parent>
							</match_parent>
						</match_buyer>
					</find_buy_offer>

					<do_all exact="$tempList.count" counter="$tl">
						<append_to_list name="$needs" exact="$tempList.{$tl}" />
					</do_all>
				</do_all>
			</do_else>

			<!-- Regular Travelling Mule Routine -->
			<do_if value="$needs.count gt 0 and $supplies.count gt 0">
				<set_value name="$innerList" exact="$needs" />
				<sort_trades name="$outerList" tradelist="$supplies" sorter="volume" />

				<do_all exact="$outerList.count" counter="$idx">
					<do_if value="not $needFound">
						<set_value name="$someOuter" exact="$outerList.{$idx}" />
						<do_all exact="$innerList.count" counter="$ctr">
							<set_value name="$someInner" exact="$innerList.{$ctr}" />
							<do_if value="$someOuter.ware.id" exact="$someInner.ware.id">
								<!-- find need -->
								<do_if value="$someInner.owner.owner == this.ship.owner">
									<set_value name="$targetAmount" exact="$someInner.desiredamount" />
								</do_if>
								<do_else>
									<set_value name="$targetAmount" exact="$someInner.amount" />
								</do_else>
								<set_value name="$cargoHauled" exact="[this.ship.cargo.{$someInner.ware}.free,$targetAmount,$someOuter.amount].min" />
								<set_value name="$currentProfit" exact="$cargoHauled * ($someInner.unitprice - $someOuter.unitprice*$profitMargin/100)" />
								<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'----'" output="false" append="true" />
								<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'cargoHauled: ' +$cargoHauled" output="false" append="true" />
								<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'buyer.unitprice: ' +$someInner.unitprice" output="false" append="true" />
								<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'seller.unitprice: ' +$someOuter.unitprice" output="false" append="true" />
								<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'currentProfit: ' +$currentProfit" output="false" append="true" />
								<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'bestProfit: ' +$bestProfit" output="false" append="true" />
								<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'this.ship.cargo.ware.max div 1.25: ' +this.ship.cargo.{$someInner.ware}.max / 1.25" output="false" append="true" />

								<do_if value="($currentProfit gt $bestProfit) and ($cargoHauled/(this.ship.cargo.{$someInner.ware}.max)) gt $minCargoUsed/100">
									<set_value name="$supplyTarget" exact="$someInner" />
									<set_value name="$bestCargo" exact="$cargoHauled" />
									<do_if value="not $needFound">
										<set_value name="$needFound" exact="true" />
										<set_value name="$supplySource" exact="$someOuter" />
									</do_if>
								</do_if>
							</do_if> <!-- need found -->
						</do_all>
						<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'need found: ' +$needFound" output="false" append="true" />


						<do_if value="$needFound">
							<do_if value="$supplySource.owner.owner == this.ship.owner">
								<set_value name="$currentProfit" exact="$bestCargo * $supplyTarget.unitprice" />
								<write_to_logbook category="upkeep" title="'Travel Mule: '+this.ship.knownname" interaction="showonmap" object="this.ship" money="$currentProfit" text="'Buying ' +$bestCargo + ' ' +$supplySource.ware + ' from ' +$supplySource.seller.knownname + ' at -- (player owned) to sell to ' + $supplyTarget.buyer.knownname + ' at ' +$supplyTarget.unitprice/100 + ' for a profit of ' +$currentProfit/100" />

								<!-- Debug: Print profit stats to logfile -->
								<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'Buying ' +$bestCargo + ' ' +$supplySource.ware + ' from ' +$supplySource.seller.knownname + ' at -- (player owned) to sell to ' + $supplyTarget.buyer.knownname + ' at ' +$supplyTarget.unitprice/100 + ' for a profit of ' +$currentProfit/100" />

							</do_if>
							<do_else>
								<set_value name="$currentProfit" exact="$bestCargo * ($supplyTarget.unitprice - $supplySource.unitprice)" />
								<write_to_logbook category="upkeep" title="'Travel Mule: '+this.ship.knownname" interaction="showonmap" object="this.ship" money="$currentProfit" text="'Buying ' +$bestCargo + ' ' +$supplySource.ware + ' from ' +$supplySource.seller.knownname + ' at ' +$supplySource.unitprice/100 + ' to sell to ' + $supplyTarget.buyer.knownname + ' at ' +$supplyTarget.unitprice/100 + ' for a profit of ' +$currentProfit/100" />

								<!-- Debug: Print profit stats to logfile -->
								<debug_to_file chance="$debugchance" name="'travelmule- ' + this.ship.knownname + ' ' + this.ship.idcode" directory="'MulesExtended'" text="'Buying ' +$bestCargo + ' ' +$supplySource.ware + ' from ' +$supplySource.seller.knownname + ' at ' +$supplySource.unitprice/100 + ' to sell to ' + $supplyTarget.buyer.knownname + ' at ' +$supplyTarget.unitprice/100 + ' for a profit of ' +$currentProfit/100" />

							</do_else>

							<create_trade_order name="$getSupply" object="this.object" tradeoffer="$supplySource" amount="$bestCargo" immediate="false" />
							<create_trade_order name="$dropSupply" object="this.object" tradeoffer="$supplyTarget" amount="$bestCargo" immediate="false" />
						</do_if>
					</do_if>
				</do_all>
			</do_if> <!-- the stations have supply and demand -->

			<remove_value name="$supplyTarget" />
			<remove_value name="$supplySource" />
			<remove_value name="$supplies" />
			<remove_value name="$needs" />
			<remove_value name="$innerList" />
			<remove_value name="$outerList" />

			<wait min="1000ms" max="5000ms" />
			<resume label="start" />
			<label name="end" />
		</actions>
	</attention>
</aiscript>